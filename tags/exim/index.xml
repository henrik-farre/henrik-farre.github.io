<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Exim on Rockhopper.dk</title>
    <link>http://hugo.rockhopper.hf/tags/exim/</link>
    <description>Recent content in Exim on Rockhopper.dk</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sat, 26 Jul 2008 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://hugo.rockhopper.hf/tags/exim/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Fast nagios exim mail queue plugin replacement</title>
      <link>http://hugo.rockhopper.hf/linux/software/fast-nagios-exim-mail-queue-plugin-replacement/</link>
      <pubDate>Sat, 26 Jul 2008 00:00:00 +0000</pubDate>
      
      <guid>http://hugo.rockhopper.hf/linux/software/fast-nagios-exim-mail-queue-plugin-replacement/</guid>
      <description>&lt;p&gt;We had a problem with the nagios check_mailq plugin at [work][1], it kept timing out. So I wrote a simple bash script (instead of 610 lines of perl) which is &amp;#8220;compatible&amp;#8221; with check_mailq (supports the same arguments) which uses &amp;#8220;exim4&amp;#8221; and is very quick. Just drop it in /usr/local/bin/check_mailq_simple.sh and adjust your nagios conf to use that instead of check_mailq&lt;/p&gt;

&lt;pre class=&#34;bash codesnip&#34; style=&#34;font-family:monospace;&#34;&gt;&lt;span class=&#34;co0&#34;&gt;#!/bin/bash&lt;/span&gt;
&amp;nbsp;
&lt;span class=&#34;re2&#34;&gt;WARNING&lt;/span&gt;=&lt;span class=&#34;st0&#34;&gt;&#34;&#34;&lt;/span&gt;
&lt;span class=&#34;re2&#34;&gt;CRITICAL&lt;/span&gt;=&lt;span class=&#34;st0&#34;&gt;&#34;&#34;&lt;/span&gt;
&lt;span class=&#34;re2&#34;&gt;MAILER&lt;/span&gt;=&lt;span class=&#34;st0&#34;&gt;&#34;&#34;&lt;/span&gt;
&lt;span class=&#34;re2&#34;&gt;TIMER&lt;/span&gt;=&lt;span class=&#34;st0&#34;&gt;&#34;&#34;&lt;/span&gt;
&amp;nbsp;
&lt;span class=&#34;kw1&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;kw3&#34;&gt;getopts&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#34;w:c:M:t&#34;&lt;/span&gt; optionName; &lt;span class=&#34;kw1&#34;&gt;do&lt;/span&gt;
  &lt;span class=&#34;kw1&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#34;&lt;span class=&#34;es3&#34;&gt;${optionName}&lt;/span&gt;&#34;&lt;/span&gt; &lt;span class=&#34;kw1&#34;&gt;in&lt;/span&gt;
    &lt;span class=&#34;kw2&#34;&gt;w&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;re2&#34;&gt;WARNING&lt;/span&gt;=&lt;span class=&#34;st0&#34;&gt;&#34;&lt;span class=&#34;es3&#34;&gt;${OPTARG}&lt;/span&gt;&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;;&lt;/span&gt;
    c&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;re2&#34;&gt;CRITICAL&lt;/span&gt;=&lt;span class=&#34;st0&#34;&gt;&#34;&lt;span class=&#34;es3&#34;&gt;${OPTARG}&lt;/span&gt;&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;;&lt;/span&gt;
    M&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;re2&#34;&gt;MAILER&lt;/span&gt;=&lt;span class=&#34;st0&#34;&gt;&#34;&lt;span class=&#34;es3&#34;&gt;${OPTARG}&lt;/span&gt;&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;;&lt;/span&gt;
    t&lt;span class=&#34;br0&#34;&gt;&amp;#41;&lt;/span&gt; &lt;span class=&#34;re2&#34;&gt;TIMER&lt;/span&gt;=&lt;span class=&#34;st0&#34;&gt;&#34;&lt;span class=&#34;es3&#34;&gt;${OPTARG}&lt;/span&gt;&#34;&lt;/span&gt;&lt;span class=&#34;sy0&#34;&gt;;;&lt;/span&gt;
  &lt;span class=&#34;kw1&#34;&gt;esac&lt;/span&gt;
&lt;span class=&#34;kw1&#34;&gt;done&lt;/span&gt;
&amp;nbsp;
&lt;span class=&#34;re2&#34;&gt;MAILS_IN_QUEUE&lt;/span&gt;=&lt;span class=&#34;sy0&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;kw2&#34;&gt;sudo&lt;/span&gt; &lt;span class=&#34;sy0&#34;&gt;/&lt;/span&gt;usr&lt;span class=&#34;sy0&#34;&gt;/&lt;/span&gt;sbin&lt;span class=&#34;sy0&#34;&gt;/&lt;/span&gt;exim4 -bpc&lt;span class=&#34;sy0&#34;&gt;`&lt;/span&gt;
&amp;nbsp;
&lt;span class=&#34;kw1&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#91;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#91;&lt;/span&gt; &lt;span class=&#34;co1&#34;&gt;${MAILS_IN_QUEUE}&lt;/span&gt; &lt;span class=&#34;re5&#34;&gt;-gt&lt;/span&gt; &lt;span class=&#34;co1&#34;&gt;${CRITICAL}&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#93;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#93;&lt;/span&gt;; &lt;span class=&#34;kw1&#34;&gt;then&lt;/span&gt;
  &lt;span class=&#34;kw3&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#34;CRITICAL: mailq is &lt;span class=&#34;es3&#34;&gt;${MAILS_IN_QUEUE}&lt;/span&gt; (threshold w = &lt;span class=&#34;es3&#34;&gt;${CRITICAL}&lt;/span&gt;)|unsent=&lt;span class=&#34;es3&#34;&gt;${MAILS_IN_QUEUE}&lt;/span&gt;;&lt;span class=&#34;es3&#34;&gt;${WARNING}&lt;/span&gt;;&lt;span class=&#34;es3&#34;&gt;${CRITICAL}&lt;/span&gt;;0&#34;&lt;/span&gt;
  &lt;span class=&#34;kw3&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;nu0&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;kw1&#34;&gt;elif&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#91;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#91;&lt;/span&gt; &lt;span class=&#34;co1&#34;&gt;${MAILS_IN_QUEUE}&lt;/span&gt; &lt;span class=&#34;re5&#34;&gt;-gt&lt;/span&gt; &lt;span class=&#34;co1&#34;&gt;${WARNING}&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#93;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#93;&lt;/span&gt;; &lt;span class=&#34;kw1&#34;&gt;then&lt;/span&gt;
  &lt;span class=&#34;kw3&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#34;WARNING: mailq is &lt;span class=&#34;es3&#34;&gt;${MAILS_IN_QUEUE}&lt;/span&gt; (threshold w = &lt;span class=&#34;es3&#34;&gt;${WARNING}&lt;/span&gt;)|unsent=&lt;span class=&#34;es3&#34;&gt;${MAILS_IN_QUEUE}&lt;/span&gt;;&lt;span class=&#34;es3&#34;&gt;${WARNING}&lt;/span&gt;;&lt;span class=&#34;es3&#34;&gt;${CRITICAL}&lt;/span&gt;;0&#34;&lt;/span&gt;
  &lt;span class=&#34;kw3&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;nu0&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;kw1&#34;&gt;elif&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#91;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#91;&lt;/span&gt; &lt;span class=&#34;co1&#34;&gt;${MAILS_IN_QUEUE}&lt;/span&gt; &lt;span class=&#34;re5&#34;&gt;-lt&lt;/span&gt; &lt;span class=&#34;co1&#34;&gt;${WARNING}&lt;/span&gt; &lt;span class=&#34;br0&#34;&gt;&amp;#93;&lt;/span&gt;&lt;span class=&#34;br0&#34;&gt;&amp;#93;&lt;/span&gt;; &lt;span class=&#34;kw1&#34;&gt;then&lt;/span&gt;
  &lt;span class=&#34;kw3&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#34;OK: mailq is &lt;span class=&#34;es3&#34;&gt;${MAILS_IN_QUEUE}&lt;/span&gt; (threshold w = &lt;span class=&#34;es3&#34;&gt;${WARNING}&lt;/span&gt;)|unsent=&lt;span class=&#34;es3&#34;&gt;${MAILS_IN_QUEUE}&lt;/span&gt;;&lt;span class=&#34;es3&#34;&gt;${WARNING}&lt;/span&gt;;&lt;span class=&#34;es3&#34;&gt;${CRITICAL}&lt;/span&gt;;0&#34;&lt;/span&gt;
  &lt;span class=&#34;kw3&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;nu0&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;kw1&#34;&gt;else&lt;/span&gt;
  &lt;span class=&#34;kw3&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;st0&#34;&gt;&#34;ERROR: something did not go right&#34;&lt;/span&gt;
  &lt;span class=&#34;kw3&#34;&gt;exit&lt;/span&gt; &lt;span class=&#34;nu0&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;kw1&#34;&gt;fi&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;This has been tested on Debian sarge.&lt;/p&gt;

&lt;p&gt;[1]: &lt;a href=&#34;http://www.bellcom.dk&#34;&gt;http://www.bellcom.dk&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
