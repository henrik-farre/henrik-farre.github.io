<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.15" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel='stylesheet' href='//fonts.googleapis.com/css?family=Open+Sans|Marcellus+SC'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
  
    <link href="/css/combined.css" rel="stylesheet" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://henrik-farre.github.io//index.xml">

    
    <title>How not to restore a Linux software raid - Rockhopper.dk</title>
    <meta property='og:title' content="How not to restore a Linux software raid - Rockhopper.dk">
    <meta property="og:type" content="article">
    

    <meta property="og:url" content="https://henrik-farre.github.io/linux/software/how-not-to-restore-a-linux-software-raid/">
    
    
  </head>

  <body>

    <header class="site">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://henrik-farre.github.io/">Rockhopper.dk</a>
          </div>

          <div id="navbar" class="collapse navbar-collapse">
            
          </div>

        </div>
      </nav>
    </header>

    <div class="site">
      <div class="container">



<div class="single">

  <div class="row">
    <div class="col-md-8">

      <article class="single" itemscope="itemscope" itemtype="http://schema.org/Article">

        <meta itemprop="mainEntityOfPage"  itemType="https://schema.org/WebPage" content="https://henrik-farre.github.io/"/>
        <meta itemprop="dateModified" content="2009-04-19T00:00:00&#43;00:00">
        <meta itemprop="headline" content="How not to restore a Linux software raid">
        <meta itemprop="description" content="We had a disk failure on one of our Xen servers at work last week, and what we thought would be a quick disk replace, turned into a small nightmare. Our setup is fairly &#8220;simple&#8221;: 2 x raid1&#8217;s consisting of sda1/sdb1 (/dev/md0 mounted at /) and sda3/sdb3 (/dev/md1 with LVM on top of it). mdadm reported that sdb1 and sdb3 had failed, so we just had to identify which disk was sdb in the server and replace it.">
        <meta itemprop="url" content="https://henrik-farre.github.io/linux/software/how-not-to-restore-a-linux-software-raid/">
        <div itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
          <meta itemprop="url" content="https://henrik-farre.github.io/images/default.jpg" />
          <meta itemprop="width" content="800">
          <meta itemprop="height" content="800">
        </div>
        <div itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
          <div itemprop="logo" itemscope itemtype="https://schema.org/ImageObject">
            <meta itemprop="url" content="https://henrik-farre.github.io/images/logo.jpg">
            <meta itemprop="width" content="100">
            <meta itemprop="height" content="100">
          </div>
          <meta itemprop="name" content="Rockhopper.dk">
        </div>
        <div itemprop="author" itemscope itemtype="https://schema.org/Person">
          <meta itemprop="name" content="Henrik Farre">
        </div>

        <header class="article-header">
          <time itemprop="datePublished" pubdate="pubdate" datetime="2009-04-19T00:00:00&#43;00:00">Sun, Apr 19, 2009</time>
          <h1 class="article-title">How not to restore a Linux software raid</h1>
        </header>

        <div class="article-body" itemprop="articleBody">
          <p>We had a disk failure on one of our Xen servers at <a href="http://www.bellcom.dk">work</a> last week, and what we thought would be a quick disk replace, turned into a small nightmare.</p>

<p>Our setup is fairly &#8220;simple&#8221;: 2 x raid1&#8217;s consisting of sda1/sdb1 (/dev/md0 mounted at /) and sda3/sdb3 (/dev/md1 with LVM on top of it).</p>

<p>mdadm reported that sdb1 and sdb3 had failed, so we just had to identify which disk was sdb in the server and replace it. Well it wasn&#8217;t easy to see which disk has which after we had opened the server, so we decided to boot the server again to look up the drives&#8217; serial number (using hdparm -I /dev/sda, and the small barcode on the front of the disk).</p>

<p>Now the fun part starts. The contents of /proc/mdstat showed something like this after the reboot:</p>

<pre>Personalities : [raid1]
md1 : active raid1 sdb3[0] sda3[1] (F)
      235400320 blocks [2/1] [U_]

md0 : active raid1 sdb1[0] (F) sda1[1]
      7815488 blocks [1/2] [_U]

unused devices: &lt;none&gt;</pre>

<p>On md0 sdb1 is failed, and on md1 it&#8217;s sda3, so one partition is marked failed on each drive. Here we made the <strong>big mistake</strong>: we decided to readd sdb1 to md0 and sdb3 to md1.</p>

<p>While the raid was syncing there was a lot of disk errors on sda1 and sda3, so we identified sda using its serial number, shutdown the server, replaced the disk, booted and everything looked fine.</p>

<p>Fast forward to the next day: we started receiving e-mails from customers saying data was missing from their sites, and they where missing data from the day the drive failed&#8230; then it dawned on us: when we readded sda3 it was overridden with the old data from sdb3 :(. Only one thing to do: restore from backup.</p>

<p>Now the question is: why the hell was sda3 marked as failed after the reboot? It was on the good drive&#8230;</p>

        </div>


        <aside>
          <div class="section"><a href="https://henrik-farre.github.io/tags/raid" class="tag">raid</a> </div>

          <div class="section share">
            <a href="http://www.facebook.com/sharer.php?src=bm&u=https%3a%2f%2fhenrik-farre.github.io%2flinux%2fsoftware%2fhow-not-to-restore-a-linux-software-raid%2f&t=How%20not%20to%20restore%20a%20Linux%20software%20raid" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-facebook"></i></a>
            <a href="http://twitter.com/intent/tweet?url=https%3a%2f%2fhenrik-farre.github.io%2flinux%2fsoftware%2fhow-not-to-restore-a-linux-software-raid%2f&text=How%20not%20to%20restore%20a%20Linux%20software%20raid&tw_p=tweetbutton" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-twitter"></i></a>
            <a href="https://plus.google.com/share?url=https%3a%2f%2fhenrik-farre.github.io%2flinux%2fsoftware%2fhow-not-to-restore-a-linux-software-raid%2f" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-google-plus"></i></a>
            <a href="http://getpocket.com/edit?url=https%3a%2f%2fhenrik-farre.github.io%2flinux%2fsoftware%2fhow-not-to-restore-a-linux-software-raid%2f&title=How%20not%20to%20restore%20a%20Linux%20software%20raid" onclick="window.open(this.href, 'PCwindow', 'width=550, height=350, menubar=no, toolbar=no, scrollbars=yes'); return false;"><i class="fa fa-get-pocket"></i></a>
          </div>

          
          
          
        </aside>

      </article>

    </div>
    <div class="col-md-4">
      
<aside class="site">

  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">LatestPosts</h2>
    </div>
    <div class="list-group">
      
      <a href="https://henrik-farre.github.io/linux/mouse-hover-not-working-in-chromechromium-solution-stop-synergy/" class="list-group-item">Mouse hover not working in Chrome/Chromium? Solution: stop synergy</a>
      
      <a href="https://henrik-farre.github.io/linux/multiple-profiles-in-firefox-tips-and-tricks/" class="list-group-item">Multiple profiles in Firefox: tips and tricks</a>
      
      <a href="https://henrik-farre.github.io/linux/zsh-promptwindow-title-trim-middle-of-path/" class="list-group-item">zsh prompt/window title: trim middle of path</a>
      
      <a href="https://henrik-farre.github.io/linux/docker-and-php-xdebug/" class="list-group-item">Docker and PHP xdebug</a>
      
      <a href="https://henrik-farre.github.io/linux/hardware/htpcnas-for-watching-netflix-on-linux-part-1-the-hardware/" class="list-group-item">HTPC/NAS for watching Netflix on Linux part 1: the hardware</a>
      
      <a href="https://henrik-farre.github.io/linux/hardware/uefi-booting-arch-linux-on-a-hp-probook-6360b/" class="list-group-item">UEFI booting Arch Linux on a HP ProBook 6360b</a>
      
      <a href="https://henrik-farre.github.io/linux/hardware/phone-and-pda/installing-cyanogenmod-7-1-on-a-sony-ericsson-xperia-arc-lt15i/" class="list-group-item">Installing CyanogenMod 7.1 on a Sony Ericsson Xperia Arc (LT15i)</a>
      
      <a href="https://henrik-farre.github.io/linux/hardware/phone-and-pda/upgrading-an-android-developer-phone-1-to-cyanogenmod-5-0-7-android-2-1/" class="list-group-item">Upgrading an Android Developer Phone 1 to Cyanogenmod 5.0.7 (Android 2.1)</a>
      
      <a href="https://henrik-farre.github.io/linux/software/mythtv/anysee-e30-c-plus-mythtv/" class="list-group-item">AnySee E30 C Plus &#43; MythTV</a>
      
      <a href="https://henrik-farre.github.io/linux/software/xfce/xfce-auto-rotate-wallpaper-without-cron/" class="list-group-item">Xfce: auto rotate wallpaper without cron</a>
      
    </div>
  </div>

  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">category</h2>
    </div>
    <div class="list-group">
      
      <a href="https://henrik-farre.github.io/categories/software" class="list-group-item">software</a>
      
      <a href="https://henrik-farre.github.io/categories/hardware" class="list-group-item">hardware</a>
      
      <a href="https://henrik-farre.github.io/categories/phone-and-pda" class="list-group-item">phone-and-pda</a>
      
      <a href="https://henrik-farre.github.io/categories/mythtv" class="list-group-item">mythtv</a>
      
      <a href="https://henrik-farre.github.io/categories/linux" class="list-group-item">linux</a>
      
      <a href="https://henrik-farre.github.io/categories/xfce" class="list-group-item">xfce</a>
      
      <a href="https://henrik-farre.github.io/categories/xorg" class="list-group-item">xorg</a>
      
      <a href="https://henrik-farre.github.io/categories/development" class="list-group-item">development</a>
      
      <a href="https://henrik-farre.github.io/categories/php" class="list-group-item">php</a>
      
      <a href="https://henrik-farre.github.io/categories/vim" class="list-group-item">vim</a>
      
    </div>
  </div>
  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">tag</h2>
    </div>
    <div class="list-group">
      
      <a href="https://henrik-farre.github.io/tags/android" class="list-group-item">android</a>
      
      <a href="https://henrik-farre.github.io/tags/mythbackend" class="list-group-item">mythbackend</a>
      
      <a href="https://henrik-farre.github.io/tags/archlinux" class="list-group-item">archlinux</a>
      
      <a href="https://henrik-farre.github.io/tags/mythfrontend" class="list-group-item">mythfrontend</a>
      
      <a href="https://henrik-farre.github.io/tags/zsh" class="list-group-item">zsh</a>
      
      <a href="https://henrik-farre.github.io/tags/motherboard" class="list-group-item">motherboard</a>
      
      <a href="https://henrik-farre.github.io/tags/dvb-c" class="list-group-item">dvb-c</a>
      
      <a href="https://henrik-farre.github.io/tags/firefox" class="list-group-item">firefox</a>
      
      <a href="https://henrik-farre.github.io/tags/review" class="list-group-item">review</a>
      
      <a href="https://henrik-farre.github.io/tags/cmd-line" class="list-group-item">cmd-line</a>
      
    </div>
  </div>
  

</aside>


    </div>
  </div>

</div>

      </div>
    </div>

    <footer class="site">
      <div class="container">
        <p>&copy; 2014 Henrik Farre</p>
        <p>Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>,</p>
        <p>Theme <a href="https://github.com/dim0627/hugo_theme_beg" target="_blank">Beg</a> designed by <a href="http://yet.unresolved.xyz" target="_blank">Daisuke Tsuji</a></p>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-2.2.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  
    <script src="/js/combined.js" ></script>

    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-4186065-1', 'auto');
    ga('send', 'pageview');
    </script>
    

  </body>
</html>

